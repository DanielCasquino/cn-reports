
\subsection{Sixth Experience}
\subsubsection{Gathering a Packet trace}

After running \texttt{ipconfig} with both the \texttt{/release} and
\texttt{/renew} options, we were able to see the following packets:

\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\linewidth]{img/6/dhcp_packets.png}
    \caption{\texttt{DHCP packets}}\label{fig:dhcp_packets}
\end{figure}

We then selected the first packet, which represents the DHCP Discover message.
We can see that it uses the UDP protocol, its source address is
\texttt{0.0.0.0}, and the destination address is \texttt{255.255.255.255}.

The \texttt{0.0.0.0} address is used as the requesting machine has no assigned
IPv4 address in the local network, and thus uses the \texttt{255.255.255.255}
address (broadcast) to \textbf{discover} DHCP servers.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\linewidth]{img/6/discover_header.png}
    \caption{\texttt{DHCP Discover header}}\label{fig:discover_header}
\end{figure}

We can also see that the transaction ID is \texttt{0x2668b858}.

After examining the \textbf{options} field, we can see 5 different pieces of
information that are requested.

\begin{itemize}
    \item DHCP message type (Discover)
    \item Parameter Request List
    \item Maximum DHCP message size
    \item Client identifier
    \item IP Address Lease Time
\end{itemize}

Now, let's take a look at the DHCP offer message. Its data is shown below.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\linewidth]{img/6/offer_header.png}
    \caption{\texttt{DHCP Offer header}}\label{fig:offer_header}
\end{figure}

We know that the offer message is a response to the previous discover message
because they use the same transaction ID. Furthermore the source IP address is
\texttt{10.100.224.1}, which is the default gateway (router address). The
destination address is the IPv4 address that would be leased to our machine.

The DHCP server also sends some information:

\begin{itemize}
    \item DHCP message type (Offer)
    \item Subnet Mask
    \item Renewal Time Value
    \item Rebinding Time Value
    \item DHCP Server identifier
\end{itemize}

After examining the offer message, it's now the turn of the request message.
Below is a screenshot of its information:

\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\linewidth]{img/6/request_header.png}
    \caption{\texttt{DHCP Request header}}\label{fig:request_header}
\end{figure}

The UDP source port number is 68, and the destination is 67. The source and
destination IP addresses are \texttt{0.0.0.0} and \texttt{255.255.255.255}
respectively. Also, the transaction ID matches the two previous packets, which
makes sense. The parameter request list is exactly the same.

Finally, we will take a look at the ACK message.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\linewidth]{img/6/ack_header.png}
    \caption{\texttt{DHCP ACK header}}\label{fig:ack_header}
\end{figure}

The source IPv4 address for the ACK is \texttt{192.168.1.1}, which is also the
DHCP server identifier and default gateway for this LAN. The destination is the
broadcast address \texttt{255.255.255.255} because, even though the server is
assigning \texttt{192.168.1.101} to the client, the client has not yet fully
configured that address and must therefore receive the ACK via broadcast. The
assigned IP appears in the \textbf{Your (client) IP address} field (\texttt{yiaddr})
and is also reiterated inside Option~54 (DHCP Server Identifier).

Questions 13 and 14 ask about the parameter-request list: both the Discover
frame~2 and the Request frame~5 ask for the exact same set of options (subnet
mask, router, DNS, NetBIOS parameters, static routes, and vendor-specific
information). This makes sense because the client still wants the same
configurationâ€”its Request simply confirms the lease offered in frame~4.

Regarding the remaining ACK details:
\begin{itemize}
    \item The lease time (Option~51) is 86\,400~seconds (one day), so that is
    how long the client can keep \texttt{192.168.1.101} before renewing.
    \item Option~3 confirms that the first-hop router on the default path is
    \texttt{192.168.1.1}, matching the gateway field observed in our ipconfig
    output.
    \item Because the message is sent from the router itself, its source MAC is
    \texttt{00:06:25:da:af:73}, matching the Linksys access point in the lab.
\end{itemize}

With the ACK processed, the four-way DHCP handshake is complete: Discover,
Offer, Request, and Ack all share transaction ID \texttt{0x3e5e0ce3}, which is
how Wireshark reconstructs the conversation. This experiment also reinforced
how DHCP relies on broadcast at first and transitions to unicast once the lease
is confirmed.
